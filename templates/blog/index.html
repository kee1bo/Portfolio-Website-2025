{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/advanced-styles.css') }}">
<style>
.blog-hero {
    background: var(--gradient-primary);
    color: white;
    padding: 8rem 0 4rem;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.blog-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><polygon fill="rgba(255,255,255,0.05)" points="0,1000 1000,0 1000,1000"/></svg>');
    background-size: 100% 100%;
}

.blog-hero-content {
    position: relative;
    z-index: 2;
}

.search-filters {
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    padding: 2rem;
    margin: -4rem auto 4rem;
    max-width: 800px;
    position: relative;
    z-index: 3;
}

.search-input {
    width: 100%;
    padding: 1rem 1.5rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    color: var(--color-text-primary);
    font-size: 1rem;
    margin-bottom: 1.5rem;
    backdrop-filter: blur(10px);
}

.search-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.filter-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.8rem;
    align-items: center;
}

.filter-tag {
    padding: 0.5rem 1rem;
    background: rgba(102, 126, 234, 0.1);
    border: 1px solid rgba(102, 126, 234, 0.2);
    border-radius: 20px;
    color: #667eea;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    font-weight: 500;
}

.filter-tag:hover,
.filter-tag.active {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
}

.blog-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
    margin: 4rem 0;
}

.blog-post-card {
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    border: 1px solid var(--glass-border);
    border-radius: 20px;
    overflow: hidden;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
}

.blog-post-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-elevated);
}

.blog-featured-image {
    height: 200px;
    background: var(--gradient-secondary);
    position: relative;
    overflow: hidden;
}

.blog-featured-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.blog-post-card:hover .blog-featured-image img {
    transform: scale(1.05);
}

.blog-content {
    padding: 2rem;
}

.blog-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    font-size: 0.9rem;
    color: var(--color-text-secondary);
}

.blog-date {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.blog-reading-time {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.blog-title {
    font-size: 1.4rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: var(--color-text-primary);
    line-height: 1.3;
}

.blog-excerpt {
    color: var(--color-text-secondary);
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.blog-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.blog-tag {
    background: rgba(245, 87, 108, 0.1);
    color: #f5576c;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
    border: 1px solid rgba(245, 87, 108, 0.2);
}

.blog-stats {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.blog-views {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin: 4rem 0;
}

.pagination-btn {
    padding: 0.8rem 1.2rem;
    background: var(--glass-bg);
    backdrop-filter: var(--glass-blur);
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    color: var(--color-text-primary);
    text-decoration: none;
    transition: all 0.3s ease;
}

.pagination-btn:hover {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
}

.pagination-btn.active {
    background: #667eea;
    color: white;
}

.pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.no-posts {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--color-text-secondary);
}

.no-posts i {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.clear-filters-btn {
    padding: 0.5rem 1rem;
    background: rgba(245, 87, 108, 0.1);
    border: 1px solid rgba(245, 87, 108, 0.2);
    border-radius: 20px;
    color: #f5576c;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.clear-filters-btn:hover {
    background: #f5576c;
    color: white;
}
</style>
{% endblock %}

{% block content %}
<section class="blog-hero">
    <div class="blog-hero-content">
        <div class="container">
            <h1 style="font-size: 3.5rem; font-weight: 800; margin-bottom: 1rem;">
                Blog & Insights
            </h1>
            <p style="font-size: 1.3rem; opacity: 0.9; max-width: 600px; margin: 0 auto;">
                Exploring the frontiers of AI, data science, and emerging technologies through in-depth articles and research insights
            </p>
        </div>
    </div>
</section>

<div class="container">
    <div class="search-filters">
        <form method="GET" action="{{ url_for('blog_index') }}">
            <input 
                type="text" 
                name="search" 
                class="search-input" 
                placeholder="Search articles by title or content..." 
                value="{{ current_filters.search }}"
            >
            
            <div class="filter-tags">
                <span style="font-weight: 600; margin-right: 1rem;">Filter by tags:</span>
                
                {% for tag in all_tags %}
                <label class="filter-tag {% if tag == current_filters.tag %}active{% endif %}">
                    <input 
                        type="radio" 
                        name="tag" 
                        value="{{ tag }}" 
                        {% if tag == current_filters.tag %}checked{% endif %}
                        style="display: none;"
                        onchange="this.form.submit()"
                    >
                    {{ tag }}
                </label>
                {% endfor %}
                
                {% if current_filters.tag or current_filters.search %}
                <button type="button" class="clear-filters-btn" onclick="clearFilters()">
                    <i data-lucide="x"></i> Clear Filters
                </button>
                {% endif %}
            </div>
        </form>
    </div>

    {% if posts %}
    <div class="blog-grid">
        {% for post in posts %}
        <article class="blog-post-card" onclick="window.location.href='/blog/{{ post.slug }}/'">
            <div class="blog-featured-image">
                {% if post.featured_image %}
                <img src="{{ post.featured_image }}" alt="{{ post.title }}">
                {% else %}
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: white; font-size: 3rem;">
                    <i data-lucide="file-text"></i>
                </div>
                {% endif %}
            </div>
            
            <div class="blog-content">
                <div class="blog-meta">
                    <div class="blog-date">
                        <i data-lucide="calendar"></i>
                        <span>{{ post.created_at[:10] if post.created_at else 'Recent' }}</span>
                    </div>
                    <div class="blog-reading-time">
                        <i data-lucide="clock"></i>
                        <span>{{ post.reading_time }} min read</span>
                    </div>
                </div>
                
                <h2 class="blog-title">{{ post.title }}</h2>
                <p class="blog-excerpt">
                    {{ post.excerpt or (post.content[:200] + '...' if post.content|length > 200 else post.content) }}
                </p>
                
                {% if post.tags %}
                <div class="blog-tags">
                    {% for tag in post.tags[:3] %}
                    <span class="blog-tag">{{ tag }}</span>
                    {% endfor %}
                    {% if post.tags|length > 3 %}
                    <span class="blog-tag">+{{ post.tags|length - 3 }} more</span>
                    {% endif %}
                </div>
                {% endif %}
                
                <div class="blog-stats">
                    <div class="blog-views">
                        <i data-lucide="eye"></i>
                        <span>{{ post.views or 0 }} views</span>
                    </div>
                    <div>
                        <i data-lucide="arrow-right"></i>
                    </div>
                </div>
            </div>
        </article>
        {% endfor %}
    </div>

    {% if total_pages > 1 %}
    <div class="pagination">
        {% if current_page > 1 %}
        <a href="{{ url_for('blog_index', page=current_page-1, tag=current_filters.tag, search=current_filters.search) }}" 
           class="pagination-btn">
            <i data-lucide="chevron-left"></i> Previous
        </a>
        {% endif %}
        
        {% for page_num in range(1, total_pages + 1) %}
        {% if page_num == current_page %}
        <span class="pagination-btn active">{{ page_num }}</span>
        {% elif page_num == 1 or page_num == total_pages or (page_num >= current_page - 1 and page_num <= current_page + 1) %}
        <a href="{{ url_for('blog_index', page=page_num, tag=current_filters.tag, search=current_filters.search) }}" 
           class="pagination-btn">{{ page_num }}</a>
        {% elif page_num == current_page - 2 or page_num == current_page + 2 %}
        <span class="pagination-btn">...</span>
        {% endif %}
        {% endfor %}
        
        {% if current_page < total_pages %}
        <a href="{{ url_for('blog_index', page=current_page+1, tag=current_filters.tag, search=current_filters.search) }}" 
           class="pagination-btn">
            Next <i data-lucide="chevron-right"></i>
        </a>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <div class="no-posts">
        <i data-lucide="search"></i>
        <h3>No articles found</h3>
        <p>Try adjusting your search criteria or browse all articles.</p>
        {% if current_filters.tag or current_filters.search %}
        <button class="btn-advanced" onclick="clearFilters()" style="margin-top: 2rem;">
            <i data-lucide="refresh-cw"></i> Clear Filters
        </button>
        {% endif %}
    </div>
    {% endif %}
</div>

<section style="padding: 6rem 0; background: var(--gradient-dark); color: white; text-align: center;">
    <div class="container">
        <h2 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 2rem;">
            Stay Updated
        </h2>
        <p style="font-size: 1.2rem; margin-bottom: 3rem; opacity: 0.9;">
            Get notified when I publish new articles about AI, data science, and technology
        </p>
        <div style="max-width: 400px; margin: 0 auto; display: flex; gap: 1rem;">
            <input type="email" placeholder="Enter your email" 
                   style="flex: 1; padding: 1rem; border: none; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; backdrop-filter: blur(10px);">
            <button class="btn-advanced" style="background: var(--gradient-accent);">
                <i data-lucide="bell"></i> Subscribe
            </button>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
function clearFilters() {
    const url = new URL(window.location);
    url.searchParams.delete('tag');
    url.searchParams.delete('search');
    url.searchParams.delete('page');
    window.location.href = url.toString();
}

// Auto-submit search form with debouncing
let searchTimeout;
document.querySelector('.search-input').addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        this.form.submit();
    }, 500);
});

// Add glassmorphism effects to blog cards
document.addEventListener('DOMContentLoaded', function() {
    const blogCards = document.querySelectorAll('.blog-post-card');
    
    blogCards.forEach(card => {
        card.addEventListener('mousemove', (e) => {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            
            const rotateX = (y - centerY) / 20;
            const rotateY = (centerX - x) / 20;
            
            card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-8px)`;
        });
        
        card.addEventListener('mouseleave', () => {
            card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) translateY(0px)';
        });
    });
});
</script>
{% endblock %}